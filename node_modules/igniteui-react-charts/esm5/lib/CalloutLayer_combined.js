/*
THIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT ("AGREEMENT") LOCATED HERE:
https://www.infragistics.com/legal/license/igultimate-la
https://www.infragistics.com/legal/license/igultimate-eula
GOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.
*/
import { __extends, __values } from "tslib";
import { AnnotationLayer } from "./AnnotationLayer";
import { DependencyProperty } from "igniteui-react-core";
import { Base, runOn, delegateCombine, String_$type, enumGetBox, EnumUtil, typeCast, fromEnum, delegateRemove, Point_$type, Date_$type, markType, markDep } from "igniteui-react-core";
import { Series } from "./Series";
import { CalloutPlacementPositionsCollection } from "./CalloutPlacementPositionsCollection";
import { AutoCalloutVisibilityMode_$type } from "./AutoCalloutVisibilityMode";
import { Brush } from "igniteui-react-core";
import { Thickness } from "igniteui-react-core";
import { CalloutCollisionMode_$type } from "./CalloutCollisionMode";
import { FontUtil } from "igniteui-react-core";
import { Rect } from "igniteui-react-core";
import { CalloutLayerFrame } from "./CalloutLayerFrame";
import { HashSet$1 } from "igniteui-react-core";
import { CalloutAnnotationWrapper } from "./CalloutAnnotationWrapper";
import { List$1 } from "igniteui-react-core";
import { LinkedList$1 } from "igniteui-react-core";
import { Dictionary$2 } from "igniteui-react-core";
import { LinkedListNode$1 } from "igniteui-react-core";
import { LabelCollisionManager } from "igniteui-react-core";
import { SeriesPointOfInterest } from "./SeriesPointOfInterest";
import { CalloutAnnotation } from "./CalloutAnnotation";
import { IFastItemsSource_$type } from "igniteui-react-core";
import { CalloutLabelUpdatingEventArgs } from "./CalloutLabelUpdatingEventArgs";
import { CalloutSeriesSelectingEventArgs } from "./CalloutSeriesSelectingEventArgs";
import { CalloutStyleUpdatingEventArgs } from "./CalloutStyleUpdatingEventArgs";
import { DeviceUtils } from "igniteui-react-core";
import { CalloutRenderStyleUpdatingEventArgs } from "./CalloutRenderStyleUpdatingEventArgs";
import { LabelCollisionInfo } from "igniteui-react-core";
import { QuadTreeBoundingBox } from "igniteui-react-core";
import { ScalerParams } from "./ScalerParams";
import { ViewportUtils } from "./ViewportUtils";
import { Size } from "igniteui-react-core";
import { CalloutContentUpdatingEventArgs } from "./CalloutContentUpdatingEventArgs";
import { CalloutKey } from "./CalloutKey";
import { DataContext } from "igniteui-react-core";
import { HashPool$2 } from "igniteui-react-core";
import { PropertyMetadata } from "igniteui-react-core";
import { isNaN_ } from "igniteui-react-core";
import { stringIsNullOrEmpty } from "igniteui-react-core";
import { FastItemObjectColumn } from "igniteui-react-core";
import { AnnotationLayerView } from "./AnnotationLayerView";
import { BrushUtil } from "igniteui-react-core";
import { TextBlock } from "igniteui-react-core";
import { Color } from "igniteui-react-core";
import { Line } from "igniteui-react-core";
import { CalloutViewHelper } from "./CalloutViewHelper";
import { Rectangle } from "igniteui-react-core";
import { TranslateTransform } from "igniteui-react-core";
/**
 * @hidden
 */
var CalloutLayer = /** @class */ /*@__PURE__*/ (function (_super) {
    __extends(CalloutLayer, _super);
    function CalloutLayer() {
        var _this = _super.call(this) || this;
        _this.calloutStyleUpdating = null;
        _this.calloutRenderStyleUpdating = null;
        _this.rr = null;
        _this.rs = null;
        _this.rt = null;
        _this.rq = null;
        _this.rp = null;
        _this.sj = new HashSet$1(CalloutAnnotationWrapper.$, 0);
        _this.sm = new List$1(CalloutAnnotationWrapper.$, 0);
        _this.sn = new List$1(CalloutAnnotationWrapper.$, 0);
        _this.rh = null;
        _this.q7 = null;
        _this.rn = null;
        _this.sk = new LinkedList$1(CalloutAnnotationWrapper.$);
        _this.sh = new Dictionary$2(CalloutAnnotationWrapper.$, LinkedListNode$1.$.specialize(CalloutAnnotationWrapper.$), 0);
        _this.rz = null;
        _this.vt = new Rect(0, 0, 0, 1, 1);
        _this.r6 = false;
        _this.sy = 0;
        _this.vs = Rect.empty;
        _this.r4 = false;
        _this.r5 = false;
        _this.calloutContentUpdating = null;
        _this.calloutLabelUpdating = null;
        _this.calloutSeriesSelecting = null;
        _this.sl = new List$1(SeriesPointOfInterest.$, 0);
        _this.r8 = false;
        _this.r9 = false;
        _this.sp = 0;
        _this.r7 = false;
        _this.r3 = true;
        _this.q9 = 1;
        FastItemObjectColumn.m();
        _this.q7 = null;
        _this.rh = new CalloutPlacementPositionsCollection();
        var a = _this.rh;
        a.collectionChanged = delegateCombine(a.collectionChanged, runOn(_this, _this.ud));
        _this.qd = true;
        var b = new CalloutLayerFrame();
        var c = new CalloutLayerFrame();
        var d = new CalloutLayerFrame();
        var e = _this.hm / 1000;
        _this.p5 = b;
        _this.p4 = c;
        _this.p6 = d;
        _this.ab = CalloutLayer.$;
        return _this;
    }
    CalloutLayer.prototype.get_c8 = function () {
        return true;
    };
    CalloutLayer.prototype.ud = function (a, b) {
        this.um();
    };
    CalloutLayer.prototype.um = function () {
        this.q7 = this.q8(this.ri);
        this.uj();
    };
    CalloutLayer.prototype.ue = function (a, b) {
        this.sn.clear();
        this.mh(false);
    };
    CalloutLayer.prototype.k0 = function (a, b, c, d) {
        _super.prototype.k0.call(this, a, b, c, d);
        var e = this.si();
        switch (a) {
            case 3:
                this.ur(b, e);
                break;
            case 1:
                for (var f = b; f < b + c; f++) {
                    var g = new CalloutAnnotation();
                    var h = new CalloutAnnotationWrapper();
                    h.b = g;
                    h.b.series = this.rm;
                    this.sn.insert(f, h);
                    this.ur(f, e);
                }
                break;
            case 0:
                this.sn.v(b, c);
                break;
            case 2:
                for (var i = b; i < b + c; i++) {
                    this.ur(i, e);
                }
                break;
            case 4:
                this.sn.clear();
                for (var j = 0; j < this.ck.count; j++) {
                    var k = new CalloutAnnotation();
                    var l = new CalloutAnnotationWrapper();
                    l.b = k;
                    l.b.series = this.rm;
                    this.sn.add(l);
                    this.ur(j, e);
                }
                break;
        }
        this.mh(true);
    };
    CalloutLayer.prototype.eo = function (a) {
        return false;
    };
    CalloutLayer.prototype.si = function () {
        var a = new Dictionary$2(String_$type, Series.$, 0);
        if (this.cd != null) {
            for (var b = 0; b < this.cd.series.count; b++) {
                var c = this.cd.series._inner[b];
                if (c.name != null && !a.containsKey(c.name)) {
                    a.addItem(c.name, c);
                }
            }
        }
        return a;
    };
    CalloutLayer.prototype.ur = function (a, b) {
        var _this = this;
        if (this.ry == null || this.rw == null) {
            return;
        }
        var c = a;
        if (this.rx != null) {
            c = this.rx.item(a);
        }
        var d = this.ry.item(a);
        var e = this.rw.item(a);
        var f = this.sn._inner[a];
        if (this.rv != null) {
            if (f.b.ab != this.rv.item(a)) {
                f.b.key = this.rv.item(a);
            }
        }
        if (this.sh.containsKey(f)) {
            f.b = this.sh.item(f).c.b;
        }
        f.b.xValue = c;
        f.b.yValue = d;
        if (this.calloutLabelUpdating != null) {
            var g = ((function () {
                var $ret = new CalloutLabelUpdatingEventArgs();
                $ret.c = c;
                $ret.d = d;
                $ret.item = _this.ck.item(a);
                return $ret;
            })());
            this.calloutLabelUpdating(this, g);
            if (g.b != null && !Base.equalsStatic(g.b, f.b.ao)) {
                var h = g.b;
                f.b.text = h != null ? h.toString() : "";
            }
        }
        else {
            f.b.text = e != null ? e.toString() : "";
        }
        if (this.ru != null) {
            f.b.content = this.ru.item(a);
        }
        else {
            f.b.content = this.ck.item(a);
        }
        if (this.calloutSeriesSelecting != null) {
            var i = ((function () {
                var $ret = new CalloutSeriesSelectingEventArgs();
                $ret.c = c;
                $ret.d = d;
                $ret.item = _this.ck.item(a);
                return $ret;
            })());
            this.calloutSeriesSelecting(this, i);
            if (i.a != null) {
                f.b.series = i.a;
            }
            else if (i.e != null) {
                if (b.containsKey(i.e)) {
                    f.b.series = b.item(i.e);
                }
            }
        }
        this.us(f);
    };
    CalloutLayer.prototype.us = function (a) {
        var b = new Thickness(0, DeviceUtils.g(3));
        if (isNaN_(this.vv.left) || isNaN_(this.vv.top) || isNaN_(this.vv.right) || isNaN_(this.vv.bottom)) {
            b = new Thickness(0, DeviceUtils.g(3));
        }
        else {
            b = this.vv;
        }
        var c = DeviceUtils.g(3);
        if (isNaN_(this.sq)) {
            c = DeviceUtils.g(3);
        }
        else {
            c = this.sq;
        }
        var d = this.vo != null ? this.vo : this.rg.ci(a.b.l);
        var e = this.vr != null ? this.vr : this.rg.cl();
        var f = this.vq != null ? this.vq : this.rg.ck(a.b.l);
        var g = this.vp != null ? this.vp : this.rg.cj(a.b.l);
        var h = isNaN_(this.sw) ? 0 : this.sw;
        if (this.sd && this.calloutStyleUpdating != null) {
            var i = new CalloutStyleUpdatingEventArgs();
            i.item = a.b.aa;
            i.xValue = a.b.ac;
            i.yValue = a.b.ad;
            i.series = a.b.l;
            i.background = d;
            i.textColor = e;
            i.outline = f;
            i.leaderBrush = g;
            i.strokeThickness = h;
            this.calloutStyleUpdating(this, i);
            d = i.background;
            e = i.textColor;
            f = i.outline;
            g = i.leaderBrush;
            h = i.strokeThickness;
        }
        a.b.backgroundPadding = b;
        a.b.backgroundCornerRadius = c;
        a.b.background = d;
        a.b.textColor = e;
        a.b.outline = f;
        a.b.leaderBrush = g;
        a.b.strokeThickness = h;
    };
    CalloutLayer.prototype.hw = function (a, b) {
        var c = this.jq(b);
        if (c == CalloutLayer.$$p[21]) {
            return this.hx(a, b, this.tx);
        }
        if (c == CalloutLayer.$$p[28]) {
            return this.hx(a, b, this.t8);
        }
        if (c == CalloutLayer.$$p[29]) {
            return this.hx(a, b, this.ub);
        }
        if (c == CalloutLayer.$$p[20]) {
            return this.hx(a, b, this.tu);
        }
        if (c == CalloutLayer.$$p[15]) {
            return this.hx(a, b, this.tn);
        }
        return _super.prototype.hw.call(this, a, b);
    };
    Object.defineProperty(CalloutLayer.prototype, "rw", {
        get: function () {
            return this.rr;
        },
        set: function (a) {
            if (this.rr != a) {
                var b = this.rr;
                this.rr = a;
                this.raisePropertyChanged("LabelColumn", b, this.rr);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "rx", {
        get: function () {
            return this.rs;
        },
        set: function (a) {
            if (this.rs != a) {
                var b = this.rs;
                this.rs = a;
                this.raisePropertyChanged("XColumn", b, this.rs);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "ry", {
        get: function () {
            return this.rt;
        },
        set: function (a) {
            if (this.rt != a) {
                var b = this.rt;
                this.rt = a;
                this.raisePropertyChanged("YColumn", b, this.rt);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "rv", {
        get: function () {
            return this.rq;
        },
        set: function (a) {
            if (this.rq != a) {
                var b = this.rq;
                this.rq = a;
                this.raisePropertyChanged("KeyColumn", b, this.rq);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "ru", {
        get: function () {
            return this.rp;
        },
        set: function (a) {
            if (this.rp != a) {
                var b = this.rp;
                this.rp = a;
                this.raisePropertyChanged("ContentColumn", b, this.rp);
            }
        },
        enumerable: false,
        configurable: true
    });
    CalloutLayer.prototype.ug = function (a, b) {
        if (b.propertyName == CalloutAnnotation.$$p[14] || b.propertyName == CalloutAnnotation.$$p[15]) {
            var c = a.k;
            if (!this.sj.contains(c)) {
                this.sj.add_1(c);
                this.sm.add(c);
                this.mh(false);
            }
        }
    };
    CalloutLayer.prototype.bx = function () {
        return new CalloutLayerView(this);
    };
    CalloutLayer.prototype.ly = function (a) {
        _super.prototype.ly.call(this, a);
        this.rg = a;
    };
    Object.defineProperty(CalloutLayer.prototype, "ri", {
        get: function () {
            return this.rh;
        },
        set: function (a) {
            var b = this.ri;
            if (a != b) {
                this.rh = a;
                this.raisePropertyChanged("AllowedPositions", b, this.ri);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "rb", {
        get: function () {
            return EnumUtil.getEnumValue(AutoCalloutVisibilityMode_$type, this.c(CalloutLayer.u7));
        },
        set: function (a) {
            this.h(CalloutLayer.u7, enumGetBox(AutoCalloutVisibilityMode_$type, a));
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "ra", {
        get: function () {
            return this.q9;
        },
        set: function (a) {
            this.q9 = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "vv", {
        get: function () {
            return new Thickness(1, this.ss, this.su, this.st, this.sr);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutLayer.prototype, "ro", {
        get: function () {
            if (this.rn == null) {
                this.rn = FontUtil.toFontInfo(this.g9, this.t2);
            }
            return this.rn;
        },
        enumerable: false,
        configurable: true
    });
    CalloutLayer.prototype.qo = function (a, b) {
        if (this.rm == null || this.rm == a) {
            if (!this.as.c) {
                this.mh(b);
            }
        }
    };
    CalloutLayer.prototype.qq = function (a, b) {
        var e_1, _a;
        _super.prototype.qq.call(this, a, b);
        var c = a;
        c.q.clear();
        c.r.clear();
        c.n.clear();
        c.f.clear();
        c.i.clear();
        c.h.clear();
        c.k.clear();
        c.m.clear();
        c.l.clear();
        c.j.clear();
        c.g.clear();
        c.o.clear();
        c.p.clear();
        c.u.clear();
        c.v.clear();
        c.s.clear();
        c.t.clear();
        var d = this.so();
        var e = new List$1(CalloutAnnotationWrapper.$, 0);
        var f = true;
        if (this.sa) {
            if (this.qb(this.rm)) {
                this.uo(this.rm, c, e);
            }
            else {
                try {
                    for (var _b = __values(fromEnum(this.cd.series)), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var g = _c.value;
                        if (this.qb(g)) {
                            if (!g.dc) {
                                if (!g.isVertical) {
                                    f = false;
                                }
                            }
                            this.uo(g, c, e);
                        }
                    }
                }
                catch (e_1_1) {
                    e_1 = { error: e_1_1 };
                }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return))
                            _a.call(_b);
                    }
                    finally {
                        if (e_1)
                            throw e_1.error;
                    }
                }
            }
        }
        if (this.sa && this.ra == 2) {
            var h = 0;
            var i = 0;
            var j = 1.7976931348623157E+308;
            var k = 1.7976931348623157E+308;
            var l = -1.7976931348623157E+308;
            var m = -1.7976931348623157E+308;
            if (e.count > 0) {
                if (e._inner[0].c != null) {
                    h = e._inner[0].e;
                    i = e._inner[0].f;
                }
                for (var n = 0; n < e.count; n++) {
                    var o = e._inner[n];
                    if (o.c != null) {
                        var p = o.e;
                        var q = o.f;
                        if (p != h) {
                            j = Math.min(j, Math.abs(p - h));
                        }
                        if (q != i) {
                            k = Math.min(k, Math.abs(q - i));
                        }
                        l = Math.max(o.c.l + o.c.l, l);
                        m = Math.max(o.c.k + o.c.k, m);
                    }
                }
                if (f) {
                    if (m > k) {
                        e.clear();
                    }
                }
                else {
                    if (l > j) {
                        e.clear();
                    }
                }
            }
        }
        this.un(c, d, e);
    };
    CalloutLayer.prototype.m5 = function (a, b) {
        _super.prototype.m5.call(this, a, b);
        var c = b.width - this.vt.width;
        var d = b.height - this.vt.height;
        var e = 0;
        if (Math.abs(c) > Math.abs(d)) {
            e = c;
            this.sp = c * this.py.width;
        }
        else {
            e = d;
            this.sp = d * this.py.height;
        }
        if (e > 0 && this.sp > 5) {
            this.r9 = true;
        }
        if (e < 0 && this.sp > 5) {
            this.r8 = true;
        }
    };
    CalloutLayer.prototype.m4 = function (a, b) {
        _super.prototype.m4.call(this, a, b);
        if (!a.equals1(b)) {
            this.r7 = true;
        }
    };
    Object.defineProperty(CalloutLayer.prototype, "vu", {
        get: function () {
            return this.vs;
        },
        set: function (a) {
            this.vs = a;
        },
        enumerable: false,
        configurable: true
    });
    CalloutLayer.prototype.un = function (a, b, c) {
        var e_2, _a;
        if (this.cd != null) {
            this.vt = this.cd.sf;
        }
        if (this.py.isEmpty) {
            return;
        }
        this.vu = new Rect(0, this.py.left, this.py.top, this.py.width, this.py.height);
        if (this.rz != null && this.tk != null && this.tk != this.rz.ap) {
            this.ui();
        }
        if (this.rz == null) {
            var d = this.r0();
            if (d != null) {
                this.rz = d;
                var e = this.rz;
                e.labelsMoved = delegateCombine(e.labelsMoved, runOn(this, this.uf));
            }
            else {
                var f = this.pq(this.b0);
                var g = new Array(2);
                g[0] = 0;
                g[1] = 3;
                if (this.rm != null) {
                    if (this.rm.isVertical) {
                        g = new Array(2);
                        g[0] = 2;
                        g[1] = 1;
                    }
                }
                else {
                    var h = false;
                    if (this.cd != null && this.cd.series.count > 0) {
                        h = true;
                        try {
                            for (var _b = __values(fromEnum(this.cd.series)), _c = _b.next(); !_c.done; _c = _b.next()) {
                                var i = _c.value;
                                if (!i.dc) {
                                    if (!i.isVertical) {
                                        h = false;
                                    }
                                }
                            }
                        }
                        catch (e_2_1) {
                            e_2 = { error: e_2_1 };
                        }
                        finally {
                            try {
                                if (_c && !_c.done && (_a = _b.return))
                                    _a.call(_b);
                            }
                            finally {
                                if (e_2)
                                    throw e_2.error;
                            }
                        }
                    }
                    if (h) {
                        g = new Array(2);
                        g[0] = 2;
                        g[1] = 1;
                    }
                }
                this.rz = new LabelCollisionManager(this.py.right, this.py.bottom, this.py, this.rg.j(), this.sv, this.r1(), g, this.s2(), this.s1(), this.sb, this.q7);
                if (this.tk != null) {
                    this.rz.ap = this.tk;
                    this.rz.an = this;
                }
                var j = this.rz;
                j.labelsMoved = delegateCombine(j.labelsMoved, runOn(this, this.uf));
            }
        }
        if (this.r8) {
            this.r8 = false;
            if (this.rz.al > 2) {
                this.r6 = true;
            }
        }
        if (this.r9) {
            this.r9 = false;
            if (this.sp > 5) {
                this.r6 = true;
            }
        }
        if (this.r7) {
            this.r7 = false;
            this.rz.a3(this.py.right, this.py.bottom, this.py);
            this.r6 = true;
        }
        var k = new HashSet$1(CalloutAnnotationWrapper.$, 0);
        var l = new HashSet$1(CalloutAnnotationWrapper.$, 0);
        var m = new List$1(CalloutAnnotationWrapper.$, 0);
        var n = new List$1(CalloutAnnotationWrapper.$, 0);
        var o = new HashSet$1(CalloutAnnotationWrapper.$, 0);
        for (var p = 0; p < b.count; p++) {
            o.add_1(b._inner[p]);
        }
        for (var q = 0; q < c.count; q++) {
            o.add_1(c._inner[q]);
        }
        var r = this.sk.c;
        while (r != null) {
            var s = r.a;
            if (!o.contains(r.c)) {
                n.add(r.c);
                l.add_1(r.c);
                var t = r.c.b;
                t.propertyChanged = delegateRemove(t.propertyChanged, runOn(this, this.ug));
                this.sk.h(r);
                this.sh.removeItem(r.c);
                this.rz.a2(r.c.c);
            }
            r = s;
        }
        for (var u = 0; u < b.count; u++) {
            if (!this.sh.containsKey(b._inner[u])) {
                this.sk.f(b._inner[u]);
                var v = b._inner[u].b;
                v.propertyChanged = delegateCombine(v.propertyChanged, runOn(this, this.ug));
                this.sh.addItem(b._inner[u], this.sk.d);
                m.add(b._inner[u]);
                k.add_1(b._inner[u]);
                this.r6 = true;
            }
        }
        for (var w = 0; w < c.count; w++) {
            if (!this.sh.containsKey(c._inner[w])) {
                this.sk.f(c._inner[w]);
                this.sh.addItem(c._inner[w], this.sk.d);
                var x = c._inner[w].b;
                x.propertyChanged = delegateCombine(x.propertyChanged, runOn(this, this.ug));
                m.add(c._inner[w]);
                k.add_1(c._inner[w]);
                this.r6 = true;
            }
        }
        if (this.r4 == true) {
            this.r4 = false;
            this.r6 = true;
        }
        if (this.sm.count > 0) {
            this.r6 = true;
            this.sm.clear();
            this.sj.clear();
        }
        r = this.sk.c;
        while (r != null) {
            var y = this.r2(r.c);
            if (y == null) {
                return;
            }
            if (!Base.equalsStatic(y, r.c.c.c)) {
                var z = false;
                if (r.c.c.c == null) {
                    z = true;
                }
                var aa = r.c.c;
                aa.o = y.b;
                aa.p = y.c;
                if (!isNaN_(aa.o) && !isNaN_(aa.p)) {
                    aa.n = y.e;
                    aa.m = y.d;
                    if (aa.b == null) {
                        this.rz.t(aa, false);
                    }
                    if (z) {
                        this.rz.aq(aa);
                    }
                    else {
                        this.rz.az(aa);
                    }
                }
            }
            r = r.a;
        }
        var ab = this.rz.am();
        var ac = this.rz.u();
        if (ac) {
            if (this.rz.q()) {
                this.r6 = true;
            }
        }
        if (this.r6 && (ab != 0 || ac)) {
            this.r6 = false;
            this.sy = 0x7FFFFFFF;
            if (this.tk != null) {
                var ad = true;
                for (var ae = 0; ae < this.cd.series.count; ae++) {
                    var af = this.cd.series._inner[ae];
                    if (af.dc && typeCast(CalloutLayer.$, af) !== null) {
                        var ag = af;
                        if (ag.tk == this.tk) {
                            if (!ag.vu.equals1(this.rz.a5)) {
                                ad = false;
                                break;
                            }
                        }
                    }
                }
                if (ad) {
                    this.rz.a4();
                }
                else {
                    this.rz.ar();
                    this.rz.as();
                }
            }
            else {
                this.rz.a4();
            }
        }
        else {
            this.rz.as();
        }
        var ah = this.sk.c;
        var ai;
        var aj;
        var ak;
        var al;
        var am;
        var an;
        var ao;
        var ap;
        var aq;
        var ar;
        var as;
        var at;
        var au;
        var av;
        var aw;
        var ax;
        var ay = this.sc;
        while (ah != null) {
            var az = ah.c;
            var a0 = az.b;
            ai = a0.bk;
            aj = a0.bm;
            ak = a0.bl;
            al = a0.backgroundPadding.left;
            am = a0.backgroundPadding.top;
            an = a0.backgroundPadding.right;
            ao = a0.backgroundPadding.bottom;
            aq = a0.backgroundCornerRadius;
            ap = a0.y;
            ar = a0.bn;
            as = a0.ao;
            at = a0.aa;
            var a1 = az.c;
            au = a1.o - (a1.g - a1.l);
            av = a1.p - (a1.h - a1.k);
            aw = a1.g - a1.l;
            ax = a1.h - a1.k;
            if (ay) {
                var a2 = new CalloutRenderStyleUpdatingEventArgs();
                a2.background = ai;
                a2.outline = aj;
                a2.leaderBrush = ak;
                a2.strokeThickness = ap;
                a2.textColor = ar;
                a2.item = at;
                a2.series = a0.l;
                a2.actualPosition = a1.a;
                a2.xValue = a0.ac;
                a2.yValue = a0.ad;
                if (this.calloutRenderStyleUpdating != null) {
                    this.calloutRenderStyleUpdating(this, a2);
                    ai = a2.background;
                    aj = a2.outline;
                    ak = a2.leaderBrush;
                    ap = a2.strokeThickness;
                    ar = a2.textColor;
                }
            }
            a.n.add1(az);
            a.f.add(ai);
            a.i.add(aj);
            a.h.add(ak);
            a.k.add(al);
            a.m.add(am);
            a.l.add(an);
            a.j.add(ao);
            a.g.add(aq);
            a.o.add(ap);
            a.p.add(ar);
            a.q.add1(as);
            a.r.add1(at);
            a.u.add(au);
            a.v.add(av);
            a.s.add(aw);
            a.t.add(ax);
            ah = ah.a;
        }
    };
    CalloutLayer.prototype.ui = function () {
        if (this.rz != null) {
            var a = this.sk.c;
            while (a != null) {
                var b = a.c.c;
                if (b != null) {
                    this.rz.a2(b);
                }
                a = a.a;
            }
            var c = this.rz;
            c.labelsMoved = delegateRemove(c.labelsMoved, runOn(this, this.uf));
            this.rz = null;
        }
        this.uh();
    };
    CalloutLayer.prototype.r0 = function () {
        if (this.cd == null) {
            return null;
        }
        for (var a = 0; a < this.cd.series.count; a++) {
            var b = this.cd.series._inner[a];
            if (b.dc && typeCast(CalloutLayer.$, b) !== null) {
                var c = b;
                if (c != this) {
                    if (c.tk != null && c.tk == this.tk) {
                        if (c.rz != null) {
                            return c.rz;
                        }
                    }
                }
            }
        }
        return null;
    };
    CalloutLayer.prototype.s1 = function () {
        return 20000;
    };
    CalloutLayer.prototype.s2 = function () {
        return 300;
    };
    CalloutLayer.prototype.r1 = function () {
        switch (this.rd) {
            case 0: return 2;
            case 2: return 1;
            case 3: return 2;
            case 1: return 0;
        }
        return 2;
    };
    CalloutLayer.prototype.uf = function (a) {
        var b = this.rz.am();
        if (b < this.sy) {
            this.sy = b;
            this.mh(false);
        }
    };
    CalloutLayer.prototype.r2 = function (a) {
        var b = this.rm;
        if (a.b.l != null) {
            b = a.b.l;
        }
        if (b == null) {
            for (var c = 0; c < this.cd.series.count; c++) {
                var d = this.cd.series._inner[c];
                if (!d.dc) {
                    b = d;
                    break;
                }
            }
        }
        if (b == null) {
            return null;
        }
        var e = b.ag();
        var f = b.gc();
        var g = null;
        var h = null;
        var i = false;
        for (var j = 0; j < e.length; j++) {
            if (e[j].b8) {
                i = true;
                g = e[j];
            }
            else if (e[j].cl) {
                i = true;
                h = e[j];
            }
            else if (e[j].co) {
                h = e[j];
            }
            else {
                g = e[j];
            }
        }
        if (g == null || h == null) {
            return null;
        }
        if (!g.cn() || !h.cn()) {
            return null;
        }
        var k = 0;
        var l = 0;
        if (g.ca && g.categoryMode != 0) {
            if (b.dp) {
                k = b.getOffsetValue();
            }
            else if (b.dg) {
                k = b.getOffsetValue();
            }
        }
        if (h.ca && h.categoryMode != 0) {
            if (b.dg) {
                l = b.getOffsetValue();
            }
        }
        var m = new ScalerParams(0, this.cd.sf, g.kc, g.cg, g.j7());
        m.b = f;
        var n = new ScalerParams(0, this.cd.sf, h.kc, h.cg, h.j7());
        n.b = f;
        var o = 0;
        var p = 0;
        if (i) {
            o = g.ei(this.sx(a.b.ac), m) + k;
            p = h.ei(this.sx(a.b.ad), n) + l;
            var q = o;
            var r = p;
            var s = { $type: Point_$type, x: 0.5, y: 0.5 };
            var t = s.x + (r * Math.cos(q));
            o = ViewportUtils.c(t, m.e, m.d);
            var u = s.y + (r * Math.sin(q));
            p = ViewportUtils.f(u, n.e, n.d);
        }
        else {
            o = g.ei(this.sx(a.b.ac), m) + k;
            p = h.ei(this.sx(a.b.ad), n) + l;
        }
        var v = new QuadTreeBoundingBox();
        v.b = o;
        v.c = p;
        v.e = 3;
        v.d = 3;
        v.g = a.b;
        return v;
    };
    CalloutLayer.prototype.sx = function (a) {
        if (typeCast(Date_$type, a) !== null) {
            return a.getTime();
        }
        if (a == null) {
            return 0;
        }
        return a;
    };
    CalloutLayer.prototype.so = function () {
        var a = new List$1(CalloutAnnotationWrapper.$, 0);
        for (var b = 0; b < this.sn.count; b++) {
            if (stringIsNullOrEmpty(this.sn._inner[b].b.ao)) {
                continue;
            }
            if (this.sn._inner[b].c == null) {
                var c = new LabelCollisionInfo();
                this.sn._inner[b].c = c;
                var d = this.rg.cn(this.s3(this.sn._inner[b]), this.sn._inner[b].b.backgroundPadding);
                c.k = d.height / 2;
                c.l = d.width / 2;
            }
            var e = this.r2(this.sn._inner[b]);
            if (e == null || e.b < this.py.left || e.b > this.py.right || e.c < this.py.top || e.c > this.py.bottom) {
                continue;
            }
            a.add(this.sn._inner[b]);
        }
        return a;
    };
    CalloutLayer.prototype.s3 = function (a) {
        return a.b.ao;
    };
    CalloutLayer.prototype.qb = function (a) {
        if (!_super.prototype.qb.call(this, a)) {
            return false;
        }
        if (this.tz != null) {
            if (a.du) {
                var b = a.jp();
                if (!Base.equalsStatic(this.tz, b)) {
                    return false;
                }
            }
            else {
                if (!Base.equalsStatic(this.tz, a.name)) {
                    return false;
                }
            }
        }
        return true;
    };
    CalloutLayer.prototype.lr = function () {
        _super.prototype.lr.call(this);
        if (!this.as.c && !this.cv()) {
            return;
        }
        if (this.r3) {
            this.r3 = false;
            this.uk();
        }
        if (this.cv()) {
            this.uq(this.p6, false);
        }
        else {
            this.uq(this.p4, false);
        }
    };
    CalloutLayer.prototype.ul = function () {
        if (!this.r5) {
            this.r5 = true;
            this.mh(true);
        }
    };
    CalloutLayer.prototype.uo = function (a, b, c) {
        var d = false;
        if (this.r5) {
            this.r5 = false;
            d = true;
        }
        if (a.c1(this.sl, this.sg, this.se, this.sz)) {
            var e = this.sl;
            var _loop_1 = function (f) {
                var g = e._inner[f];
                var h = g.a != null ? g.a.item : null;
                var i = g.a.item != null ? g.a.item : g.a;
                var j = a;
                var k = new CalloutKey(i, j);
                var l = new CalloutAnnotationWrapper();
                var m = new CalloutAnnotation();
                l.b = m;
                m.key = k;
                var n = false;
                if (this_1.sh.containsKey(l)) {
                    l = this_1.sh.item(l).c;
                    m = l.b;
                    n = d;
                }
                else {
                    n = true;
                }
                var o = m.ac;
                var p = m.ad;
                if (this_1.sx(o) != this_1.sx(g.b)) {
                    m.xValue = g.b;
                }
                if (this_1.sx(p) != this_1.sx(g.c)) {
                    m.yValue = g.c;
                }
                m.series = a;
                var q = false;
                if (g.d != m.ay) {
                    m.ay = g.d;
                    q = true;
                }
                if (n || q) {
                    if (this_1.calloutLabelUpdating != null) {
                        var r = ((function () {
                            var $ret = new CalloutLabelUpdatingEventArgs();
                            $ret.c = m.ac;
                            $ret.d = m.ad;
                            $ret.item = h;
                            return $ret;
                        })());
                        this_1.calloutLabelUpdating(this_1, r);
                        if (r.b != null && !Base.equalsStatic(r.b, l.b.ao)) {
                            var s = r.b;
                            l.b.text = s != null ? s.toString() : "";
                        }
                    }
                    else {
                        if (g.d != null) {
                            m.text = g.d;
                        }
                    }
                }
                if (m.ao == null) {
                    return "continue";
                }
                if (n || q) {
                    if (this_1.calloutContentUpdating != null) {
                        var t = ((function () {
                            var $ret = new CalloutContentUpdatingEventArgs();
                            $ret.c = m.ac;
                            $ret.d = m.ad;
                            $ret.item = h;
                            $ret.a = i;
                            return $ret;
                        })());
                        this_1.calloutContentUpdating(this_1, t);
                        if (t.a != null && t.a != l.b.aa) {
                            l.b.content = t.a;
                        }
                    }
                    else {
                        if (i != null && i != l.b.aa) {
                            l.b.content = i;
                        }
                    }
                }
                if (n) {
                    this_1.us(l);
                }
                if (l.c == null) {
                    var u = new LabelCollisionInfo();
                    l.c = u;
                    var v = this_1.rg.cn(this_1.s3(l), l.b.backgroundPadding);
                    u.k = v.height / 2;
                    u.l = v.width / 2;
                }
                var w = this_1.r2(l);
                if (w == null || w.b < this_1.py.left || w.b > this_1.py.right || w.c < this_1.py.top || w.c > this_1.py.bottom) {
                    return "continue";
                }
                l.e = w.b;
                l.f = w.c;
                c.add(l);
            };
            var this_1 = this;
            for (var f = 0; f < this.sl.count; f++) {
                _loop_1(f);
            }
        }
    };
    CalloutLayer.prototype.bp = function () {
        return 1;
    };
    CalloutLayer.prototype.at = function (a, b) {
        var c = this.rz.f(a, b);
        if (c == null) {
            return null;
        }
        return c.u;
    };
    CalloutLayer.prototype.ev = function (a, b) {
        if (this.rz == null) {
            return false;
        }
        return this.rz.f(a, b) != null;
    };
    CalloutLayer.prototype.uq = function (a, b) {
        var e_3, _a;
        var c = 0;
        var d = new HashSet$1(CalloutAnnotationWrapper.$, 0);
        for (c = 0; c < a.q.count; c++) {
            var e = a.n._inner[c];
            if (isNaN_(a.u._inner[c]) || isNaN_(a.v._inner[c])) {
                continue;
            }
            var f = this.rg.b8.item(e);
            d.add_1(e);
            if (f.h != a.q._inner[c]) {
                f.h = a.q._inner[c];
                var g = f.u();
            }
            f.e = a.o._inner[c];
            f.m = a.f._inner[c];
            f.p = a.p._inner[c];
            f.o = f.e > 0 ? a.i._inner[c] : this.b0.bq();
            f.n = a.h._inner[c];
            f.x = new Thickness(1, a.k._inner[c], a.m._inner[c], a.l._inner[c], a.j._inner[c]);
            f.d = a.g._inner[c];
            this.rg.cg(f, Math.min(a.s._inner[c], a.s._inner[c] + a.u._inner[c]), Math.min(a.t._inner[c], a.t._inner[c] + a.v._inner[c]));
            this.rg.ch(f, e, a.r._inner[c]);
            f.r = { $type: Point_$type, x: a.u._inner[c], y: a.v._inner[c] };
        }
        var h = new List$1(CalloutAnnotationWrapper.$, 0);
        try {
            for (var _b = __values(fromEnum(this.rg.b8.c)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var i = _c.value;
                if (!d.contains(i)) {
                    h.add(i);
                }
            }
        }
        catch (e_3_1) {
            e_3 = { error: e_3_1 };
        }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return))
                    _a.call(_b);
            }
            finally {
                if (e_3)
                    throw e_3.error;
            }
        }
        for (var j = 0; j < h.count; j++) {
            this.rg.b8.h(h._inner[j]);
        }
    };
    CalloutLayer.prototype.qt = function (a, b) {
        _super.prototype.qt.call(this, a, b);
        if (this.cv()) {
            this.uq(this.p6, true);
        }
        else {
            this.uq(this.p4, false);
        }
    };
    CalloutLayer.prototype.em = function () {
        return true;
    };
    CalloutLayer.prototype.l3 = function (a, b, c, d) {
        _super.prototype.l3.call(this, a, b, c, d);
        switch (b) {
            case CalloutLayer.$$p[24]:
                this.rn = null;
                this.rg.cf();
                this.mh(true);
                break;
            case CalloutLayer.$$p[22]:
            case CalloutLayer.$$p[23]:
                this.mh(true);
                break;
            case CalloutLayer.$$p[14]:
                this.mh(true);
                break;
            case "SeriesViewer":
                if (c != null) {
                    var e = c;
                    e.seriesAnimating = delegateRemove(e.seriesAnimating, runOn(this, this.up));
                }
                if (d != null) {
                    var f = d;
                    f.seriesAnimating = delegateCombine(f.seriesAnimating, runOn(this, this.up));
                }
                if (d == null) {
                    this.ui();
                }
                break;
            case "AutoCalloutVisibilityMode":
                this.ra = this.rc();
                this.uj();
                break;
            case "AllowedPositions":
                if (c != null) {
                    var g = c;
                    g.collectionChanged = delegateRemove(g.collectionChanged, runOn(this, this.ud));
                }
                if (d != null) {
                    var h = d;
                    h.collectionChanged = delegateCombine(h.collectionChanged, runOn(this, this.ud));
                }
                this.q7 = this.q8(this.ri);
                this.uj();
                break;
            case CalloutLayer.$$p[16]:
            case CalloutLayer.$$p[17]:
            case CalloutLayer.$$p[1]:
            case CalloutLayer.$$p[6]:
            case CalloutLayer.$$p[5]:
            case CalloutLayer.$$p[25]:
            case CalloutLayer.$$p[26]:
            case CalloutLayer.$$p[19]:
            case CalloutLayer.$$p[18]:
            case CalloutLayer.$$p[8]:
            case CalloutLayer.$$p[10]:
            case CalloutLayer.$$p[9]:
            case CalloutLayer.$$p[7]:
            case CalloutLayer.$$p[12]:
            case CalloutLayer.$$p[13]:
                this.uj();
                break;
            case CalloutLayer.$$p[21]:
                if (this.ck != null) {
                    this.ck.deregisterColumn(this.rw);
                    this.rw = this.cj(this.tx);
                }
                break;
            case "LabelColumn":
                this.uj();
                break;
            case CalloutLayer.$$p[15]:
                if (this.ck != null) {
                    this.ck.deregisterColumn(this.ru);
                    this.ru = this.cj(this.tn);
                }
                break;
            case "ContentColumn":
                this.uj();
                break;
            case CalloutLayer.$$p[28]:
                if (this.ck != null) {
                    this.ck.deregisterColumn(this.rx);
                    this.rx = stringIsNullOrEmpty(this.t8) == false ? this.cj(this.t8) : null;
                }
                break;
            case "XColumn":
                this.uj();
                break;
            case CalloutLayer.$$p[29]:
                if (this.ck != null) {
                    this.ck.deregisterColumn(this.ry);
                    this.ry = this.cj(this.ub);
                }
                break;
            case "YColumn":
                this.uj();
                break;
            case CalloutLayer.$$p[20]:
                if (this.ck != null) {
                    this.ck.deregisterColumn(this.rv);
                    this.rv = this.cj(this.tu);
                }
                break;
            case "KeyColumn":
                this.uj();
                break;
            case "FastItemsSource":
                this.r4 = true;
                if (typeCast(IFastItemsSource_$type, c) != null) {
                    c.deregisterColumn(this.rw);
                    c.deregisterColumn(this.ru);
                    c.deregisterColumn(this.rx);
                    c.deregisterColumn(this.ry);
                    c.deregisterColumn(this.rv);
                    this.rw = null;
                    this.ru = null;
                    this.rx = null;
                    this.ry = null;
                    this.rv = null;
                    this.sn.clear();
                }
                if (typeCast(IFastItemsSource_$type, d) != null) {
                    this.rw = this.cj(this.tx);
                    this.ru = this.cj(this.tn);
                    if (stringIsNullOrEmpty(this.t8) == false) {
                        this.rx = this.cj(this.t8);
                    }
                    this.ry = this.cj(this.ub);
                    this.rv = this.cj(this.tu);
                }
                this.uj();
                break;
        }
    };
    CalloutLayer.prototype.rc = function () {
        if (this.rb == 0) {
            return 1;
        }
        return this.rb;
    };
    CalloutLayer.prototype.q8 = function (a) {
        if (a == null || a.count == 0) {
            return null;
        }
        var b = new Array(a.count);
        for (var c = 0; c < a.count; c++) {
            b[c] = a._inner[c];
        }
        return b;
    };
    CalloutLayer.prototype.up = function (a) {
        if (a.dc) {
            return;
        }
        if ((a == this.rm || this.rm == null) && this.sa) {
            this.mh(false);
        }
    };
    CalloutLayer.prototype.uj = function () {
        if (this.r3 == false) {
            this.r3 = true;
            this.mh(false);
        }
    };
    CalloutLayer.prototype.uh = function () {
        this.rg.b8.clear();
        this.sk.g();
        this.sh.clear();
    };
    CalloutLayer.prototype.uk = function () {
        if (this.ry == null || this.rw == null) {
            var a = this.sk.c;
            while (a != null) {
                this.us(a.c);
                a = a.a;
            }
            return;
        }
        var b = this.si();
        for (var c = 0; c < this.ry.count; c++) {
            var d = void 0;
            if (this.sn.count <= c) {
                var e = new CalloutAnnotation();
                d = new CalloutAnnotationWrapper();
                d.b = e;
                d.b.series = this.rm;
                this.sn.add(d);
            }
            else {
                d = this.sn._inner[c];
            }
            this.ur(c, b);
        }
    };
    CalloutLayer.$t = markType(CalloutLayer, 'CalloutLayer', AnnotationLayer.$);
    CalloutLayer.u7 = DependencyProperty.i("AutoCalloutVisibilityMode", AutoCalloutVisibilityMode_$type, CalloutLayer.$, new PropertyMetadata(2, enumGetBox(AutoCalloutVisibilityMode_$type, 0), function (a, b) { return a.raisePropertyChanged("AutoCalloutVisibilityMode", b.oldValue, b.newValue); }));
    CalloutLayer.$$p = markDep(DependencyProperty, PropertyMetadata, CalloutLayer, 'raisePropertyChanged', ['AutoCalloutLabelPrecision:sz:ut', [1, 5], 'CalloutBackground:vo:uu', [Brush.$, null], 'CalloutCollisionMode:rd:uv', [CalloutCollisionMode_$type, enumGetBox(CalloutCollisionMode_$type, 3)], 'CalloutCornerRadius:sq:uw', [1, NaN], 'CalloutInterpolatedValuePrecision:s0:ux', [1, -1], 'CalloutLeaderBrush:vp:uy', [Brush.$, null], 'CalloutOutline:vq:uz', [Brush.$, null], 'CalloutPaddingBottom:sr:u0', [1, NaN], 'CalloutPaddingLeft:ss:u1', [1, NaN], 'CalloutPaddingRight:st:u2', [1, NaN], 'CalloutPaddingTop:su:u3', [1, NaN], 'CalloutPositionPadding:sv:u4', [1, 10], 'CalloutStrokeThickness:sw:u5', [1, NaN], 'CalloutTextColor:vr:u6', [Brush.$, null], 'CollisionChannel:tk:u8', [2, null], 'ContentMemberPath:tn:u9', [2, null], 'IsAutoCalloutBehaviorEnabled:sa:va', [0, false], 'IsCalloutOffsettingEnabled:sb:vb', [0, true], 'IsCustomCalloutRenderStyleEnabled:sc:vc', [0, false], 'IsCustomCalloutStyleEnabled:sd:vd', [0, false], 'KeyMemberPath:tu:ve', [2, null], 'LabelMemberPath:tx:vf', [2, null], 'TargetSeriesName:tz:vg', [2, null], 'TargetSeries:rm:vh', [Series.$, null], 'TextStyle:t2:vi', [2, null], 'UseInterpolatedValueForAutoCalloutLabels:se:vj', [0, false], 'UseSeriesColorForOutline:sf:vk', [0, false], 'UseValueForAutoCalloutLabels:sg:vl', [0, true], 'XMemberPath:t8:vm', [2, null], 'YMemberPath:ub:vn', [2, null]]);
    return CalloutLayer;
}(AnnotationLayer));
export { CalloutLayer };
/**
 * @hidden
 */
var CalloutLayerView = /** @class */ /*@__PURE__*/ (function (_super) {
    __extends(CalloutLayerView, _super);
    function CalloutLayerView(a) {
        var _this = _super.call(this, a) || this;
        _this.b4 = null;
        _this.b9 = null;
        _this.b8 = null;
        _this.ca = NaN;
        _this.b5 = null;
        _this.b4 = a;
        _this.b9 = new List$1(CalloutView.$, 0);
        return _this;
    }
    CalloutLayerView.prototype.as = function () {
        var _this = this;
        _super.prototype.as.call(this);
        this.b8 = ((function () {
            var $ret = new HashPool$2(CalloutAnnotationWrapper.$, CalloutView.$);
            $ret.create = runOn(_this, _this.b6);
            $ret.activate = runOn(_this, _this.cc);
            $ret.disactivate = runOn(_this, _this.ce);
            $ret.destroy = runOn(_this, _this.cd);
            return $ret;
        })());
    };
    CalloutLayerView.prototype.b6 = function () {
        var a = new CalloutView(this);
        this.b9.add(a);
        return a;
    };
    CalloutLayerView.prototype.cc = function (a) {
        a.y = 0;
    };
    CalloutLayerView.prototype.ce = function (a) {
        a.y = 1;
    };
    CalloutLayerView.prototype.cd = function (a) {
        this.b9.remove(a);
    };
    CalloutLayerView.prototype.cm = function (a) {
        if (a == null) {
            return a;
        }
        return BrushUtil.l(a, 0.1);
    };
    CalloutLayerView.prototype.a6 = function (a, b) {
        _super.prototype.a6.call(this, a, b);
        a.ac(this.b7());
        if (a.d && !b) {
            for (var c = 0; c < this.b9.count; c++) {
                var d = this.b9._inner[c];
                if (d.y == 0) {
                    d.j(a);
                }
            }
        }
    };
    CalloutLayerView.prototype.b7 = function () {
        if (this.b4.ro != null) {
            return this.b4.ro;
        }
        return this.e.cd.getFontInfo();
    };
    CalloutLayerView.prototype.al = function (a) {
        _super.prototype.al.call(this, a);
        for (var b = 0; b < this.b9.count; b++) {
            var c = this.b9._inner[b];
            if (c.y != 0) {
                continue;
            }
            c.i(this.b4, this.b7(), a);
        }
    };
    CalloutLayerView.prototype.co = function (a) {
        this.k.ac(this.b7());
        this.ca = this.cb();
        var b = this.k.ag(a, this.ca, true);
        return new Size(1, b.c, b.b);
    };
    CalloutLayerView.prototype.cb = function () {
        var a = this.b7();
        if (isNaN_(this.ca)) {
            var b = FontUtil.getCurrentFontHeight(this.e.cd.cq.j.ae, a);
            this.ca = b;
        }
        return this.ca;
    };
    CalloutLayerView.prototype.cn = function (a, b) {
        if (this.b5 == null) {
            this.b5 = new CalloutView(this);
        }
        this.b5.h = a;
        this.b5.x = b;
        var c = this.b5.u();
        this.b5.h = null;
        return c;
    };
    CalloutLayerView.prototype.cg = function (a, b, c) {
        a.f = b;
        a.g = c;
    };
    CalloutLayerView.prototype.ch = function (a, b, c) {
        a.k(this.e, b, c);
    };
    CalloutLayerView.prototype.ci = function (a) {
        if (a != null) {
            return this.cm(a.o3);
        }
        return this.e.o3;
    };
    CalloutLayerView.prototype.cl = function () {
        return ((function () {
            var $ret = new Brush();
            $ret.color = Color.u(255, 255, 255, 255);
            return $ret;
        })());
    };
    CalloutLayerView.prototype.ck = function (a) {
        if (this.b4.sf) {
            if (a != null) {
                return this.cm(a.o3);
            }
        }
        return ((function () {
            var $ret = new Brush();
            $ret.color = Color.u(255, 255, 255, 255);
            return $ret;
        })());
    };
    CalloutLayerView.prototype.cj = function (a) {
        if (a != null) {
            return this.cm(a.oy);
        }
        return this.e.oy;
    };
    CalloutLayerView.prototype.cf = function () {
        this.ca = NaN;
    };
    CalloutLayerView.$t = markType(CalloutLayerView, 'CalloutLayerView', AnnotationLayerView.$);
    return CalloutLayerView;
}(AnnotationLayerView));
export { CalloutLayerView };
/**
 * @hidden
 */
var CalloutView = /** @class */ /*@__PURE__*/ (function (_super) {
    __extends(CalloutView, _super);
    function CalloutView(a) {
        var _this = _super.call(this) || this;
        _this.a = null;
        _this.y = 0;
        _this.l = null;
        _this.t = null;
        _this.q = { $type: Point_$type, x: 0, y: 0 };
        _this.s = null;
        _this.w = new Thickness(0, 0);
        _this.v = null;
        _this.c = 0;
        _this.f = 0;
        _this.g = 0;
        _this.b = null;
        _this.s = new Line();
        _this.s.ab = false;
        _this.s._stroke = ((function () {
            var $ret = new Brush();
            $ret.color = Color.u(255, 0, 0, 0);
            return $ret;
        })());
        _this.s.ac = 2;
        _this.l = new TextBlock();
        _this.t = new Rectangle();
        _this.t.ac = 0;
        _this.a = a;
        _this.y = 0;
        return _this;
    }
    CalloutView.prototype.j = function (a) {
        a.z();
        a.af(this.f, this.g);
        var b = new TranslateTransform();
        b.j = this.v.left;
        b.k = this.v.top;
        this.t.j = b;
        a.r(this.s);
        a.z();
        this.t.width = this.l.m + this.w.left + this.w.right;
        this.t.height = this.l.l + this.w.top + this.w.bottom;
        this.t.am = this.c;
        this.t.an = this.c;
        a.j(this.t.j);
        a.v(this.t);
        this.l.ag = true;
        this.l.o = this.w.top;
        this.l.n = this.w.left;
        a.w(this.l);
        a.y();
        a.y();
    };
    Object.defineProperty(CalloutView.prototype, "r", {
        get: function () {
            return this.q;
        },
        set: function (a) {
            if (this.q.x != a.x || this.q.y != a.y) {
                var b = this.u();
                var c = b.height;
                var d = b.width;
                this.q = a;
                var e = CalloutViewHelper.b(this.r, d, c, this.s);
                this.v = e;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "p", {
        get: function () {
            return this.l.ao;
        },
        set: function (a) {
            this.l.ao = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "o", {
        get: function () {
            return this.t._stroke;
        },
        set: function (a) {
            this.t._stroke = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "n", {
        get: function () {
            return this.s._stroke;
        },
        set: function (a) {
            this.s._stroke = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "m", {
        get: function () {
            return this.t._fill;
        },
        set: function (a) {
            this.t._fill = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "e", {
        get: function () {
            return this.t.ac;
        },
        set: function (a) {
            this.t.ac = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "x", {
        get: function () {
            return this.w;
        },
        set: function (a) {
            this.w = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "d", {
        get: function () {
            return this.c;
        },
        set: function (a) {
            this.c = a;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CalloutView.prototype, "h", {
        get: function () {
            return this.l.al;
        },
        set: function (a) {
            if (a == null) {
                this.l.al = "";
            }
            else {
                this.l.al = a.toString();
            }
            var b = this.u();
            var c = b.height;
            var d = b.width;
            var e = CalloutViewHelper.b(this.r, d, c, this.s);
            this.v = e;
        },
        enumerable: false,
        configurable: true
    });
    CalloutView.prototype.u = function () {
        var a = this.a.co(this.l);
        this.l.m = a.width;
        this.l.l = a.height;
        return new Size(1, a.width + this.w.left + this.w.right, a.height + this.w.top + this.w.bottom);
    };
    CalloutView.prototype.k = function (a, b, c) {
        if (this.b == null) {
            this.b = new DataContext();
        }
        this.b.series = a;
        this.b.item = c;
        if (b.c != null) {
            b.c.u = this.b;
        }
    };
    CalloutView.prototype.i = function (a, b, c) {
        a.a8.exportCalloutData(this.f, this.g, this.v.left, this.v.top, c, this.t, this.l, b, this.s, "callout", ["Main", "Callout"]);
    };
    CalloutView.$t = markType(CalloutView, 'CalloutView');
    return CalloutView;
}(Base));
export { CalloutView };
